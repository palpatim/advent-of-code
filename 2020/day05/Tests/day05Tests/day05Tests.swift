import XCTest
@testable import day05

final class day05Tests: XCTestCase {

    func testSeatId() {
        var pass: BoardingPass

        pass = BoardingPass(rowIndex: 44, colIndex: 5)
        XCTAssertEqual(pass.seatId, 357)

        pass = BoardingPass(rowIndex: 70, colIndex: 7)
        XCTAssertEqual(pass.seatId, 567)

        pass = BoardingPass(rowIndex: 14, colIndex: 7)
        XCTAssertEqual(pass.seatId, 119)

        pass = BoardingPass(rowIndex: 102, colIndex: 4)
        XCTAssertEqual(pass.seatId, 820)
    }

    func testPassParsing() {
        var pass: BoardingPass

        pass = BoardingPass(boardingPassCode: "FBFBBFFRLR")
        XCTAssertEqual(pass.rowIndex, 44)
        XCTAssertEqual(pass.colIndex, 5)
        XCTAssertEqual(pass.seatId, 357)

        pass = BoardingPass(boardingPassCode: "BFFFBBFRRR")
        XCTAssertEqual(pass.rowIndex, 70)
        XCTAssertEqual(pass.colIndex, 7)
        XCTAssertEqual(pass.seatId, 567)

        pass = BoardingPass(boardingPassCode: "FFFBBBFRRR")
        XCTAssertEqual(pass.rowIndex, 14)
        XCTAssertEqual(pass.colIndex, 7)
        XCTAssertEqual(pass.seatId, 119)

        pass = BoardingPass(boardingPassCode: "BBFFBBFRLL")
        XCTAssertEqual(pass.rowIndex, 102)
        XCTAssertEqual(pass.colIndex, 4)
        XCTAssertEqual(pass.seatId, 820)
    }

    func testPart1() {
        let passCodes = realInput.split(separator: "\n").map(String.init)
        let passes = passCodes.map { BoardingPass(boardingPassCode: $0) }
        let maxSeatId = passes.map { $0.seatId }.max()
        XCTAssertEqual(901, maxSeatId)
    }

    func testPart2() {
        let passCodes = realInput.split(separator: "\n").map(String.init)
        let passes = passCodes.map { BoardingPass(boardingPassCode: $0) }
        let sortedSeatIds = passes.map { $0.seatId }.sorted()

        // Not going to put this into the main body, this is just a binary search
        let offset = sortedSeatIds.first!
        var startIndex = sortedSeatIds.startIndex
        var endIndex = sortedSeatIds.endIndex

        while startIndex < endIndex {
            let midpoint = startIndex + ((endIndex - startIndex) / 2)
            // If the offset matches, then we haven't yet hit the missing item,
            // so the missing item is in the upper half of the list. If it
            // doesn't match, then the item is in the lower half of the list.
            if sortedSeatIds[midpoint] - midpoint == offset {
                startIndex = midpoint + 1
            } else {
                endIndex = midpoint
            }
        }

        let actualSeatId = sortedSeatIds[endIndex] - 1
        XCTAssertEqual(661, actualSeatId)
    }
}

// MARK: - Inputs

let realInput = """
FBFFFFBRLL
FFBFFFFRLR
BFBBFFBRLL
FBBBBFFLLR
BFFFBFFLRL
FBBFBFFLRR
FBBFBFBLLL
BFFBFFFLRL
FBFFBBBLRR
BFFFFFBRRR
BFBBFFBRRL
FFBFFFBLRL
BBBFFFFLRR
BBFFBFBLRR
FBFBFFBRRR
FFBFFBBLLL
BFBFFFBRLR
BFFFFBFLLL
FFBBFFBRRL
BFBBBFBLRL
BFFBBFBLRL
FFBBBFBRRL
BFBBBFBLLR
BBFBFBBRRL
FFBBFBFRLR
BFBBFBBLLR
FFBBBBBRLL
FBFBFFFRLR
FBFBBBFRRL
FBFFBFFRLR
FBFBFBFRRL
BFBFFFFLRL
BFBFBFBRRR
FFBBBBBRRR
BFFFFBFRRR
FBBFBFBRRL
FFBFFBBLLR
FBBFFFBRRR
BFBFFBFLLL
BFFBBBBLLR
BFBFBFFRRR
BFBBFFFRLR
FBBFFBFLRR
BBFBFBBLRR
BBBFFFFLLL
FFFBBBFRRL
FFFBBFFRRL
BFFFBFBLRR
FFBBFFFRRR
BFFFBFFLLR
BBFFBBFLLR
BFFFBBFLRL
BBFBBFBRRL
FFBFFBBRLL
BFFFBBBLLR
FBBFFFFLRL
BFBFBFBRLL
FFBBFBFRLL
FBFFBBFLLR
FBFBBBFRRR
BFFFBBFRRR
FBFFBFBRRL
FBFBFBFLLR
FBBFFBBRRR
FBBBFFFRRR
BFBFBBFRLL
FBBFFFBLLL
FFBBFBBLLL
BFBFBBBRLR
FBBFFBFRLR
BFBFFBBLLR
BFFBBBFRRR
FBFBBBFLLL
BFFBFFBRLR
BBFFBFBLLL
FBBFFBFLLR
BFBFBBFRRL
FBBFFBBLLL
FFBFFFBLRR
BFFBFBBRLR
BFBBBBFRLR
BFBBFFFLLL
FBFBFBFLLL
BFBFBFFLRL
BBFBBBBRLL
FBBBBFBLLL
BFFFFFBRRL
BFBFFFFRLL
FBFBBFBRRR
FBFFFFFLRL
FFFBBFBLRL
BFFFFBBRRL
FBFBFFBLLL
BFBBBFFLRR
BFBFFBBLRL
BBFBFFBRRL
FFBFBBFLLR
FBBFFFFLLR
FBFFFFBLRL
FFFBBBBLLL
BFFBBFBLLR
BBFBBBFLRR
FBFFFBFLRL
BFFBBFFLLR
FBBBFBBLRL
FBBBBFFLLL
BFBBBBFRRL
BFFFFFBLRL
FBBFBBBLRL
FFFBBFFLRL
BBFBFFFLRR
BFBFBFBLRR
FBFBFFBRLL
FBFFFFFRLR
BFFBBBFLRR
FBBFFFBRLL
BFBBFBBRLL
BBFBBBFRRL
FBFBBFFLLL
FFFBBFBRRR
FBBBFBFLRL
FFBBFFFLRL
FBBFBBFLLL
BBFBBBBLRL
BBFBBFBLLR
BBFFFBFRLL
FFBBFBFRRL
BFBBBFFRRL
FBBBBBBRLR
BFFFFFBLLR
FBBFBBFRLR
FFFBBFBLLL
BFBFFFFRRL
BFFBFBFLLR
FBBBBBFRLL
FBBFBBBLRR
BFFFBFBRRR
FBBBFBFLLR
BFBBFFFRLL
FFBFBFFLRR
BBFFBBFRLL
FBBFBFBRLR
BBFBFBBLLR
BFFBFBBRRR
FFBBBBFRLR
FBFBBFBRRL
FBBFFFBRLR
FBFBBFFLRL
FFBBBBFLLL
FFFBBFBRRL
FBFFFBBLRL
FBBFBFBLLR
BFFBFBFLRL
FFBBFBBLLR
BFFFBFBLLL
BFBBBFBLRR
FBBBBBBLRL
BFFFFFBRLL
BBFFBBFLRR
FBBBBBBLLR
FBFFBFBRLL
BBFFFFFRLL
FBFBFBFRRR
BFBBFBFLLR
FFBFFFFLRL
BFBBFBBLRR
FBFFFBBLLL
FFBBBBFLLR
BBFFFBBRRL
BFFBFFFLLL
BFBBFFBRRR
FBFFFBFLLR
BFFFBFFLRR
FBFFBBFLRR
FFFBBBFLRL
FBFBBFBLRL
FFBBBFBRRR
BBFBBFFLLR
BBFFBFFRLL
BFFBBFFLRR
BFFBFFBLRL
BBFBFFBRRR
BBFBBBFLLL
BBFBFBFRRL
BBFFFFBLLL
FFBFBBBRRL
FBFBBBFRLR
FBFBBBBLRR
BFFFFBFRLR
FFBFBBFLRR
FFBFFBBRLR
FFFBBBFLRR
BFFBBFFRLL
BFBFFBBRLL
FFBFBBFLRL
FBBBBFFLRL
FBBFBFFRLR
FBFBBFFLRR
BBFFFBBRLR
BFFFFBBLLR
BFBBFBFRRL
FBBFBBFLRR
FBFBFBFLRL
BFFBFFBRLL
BBFBFFFRRR
FBBBBFFRLL
FFBBBBFLRR
FBBFFFFRLL
FFFBFBFRLL
FBBBBFBLRL
FBFFBBFLRL
FFBFBFBRRL
FFBFBFFRLL
FBBFBFFLLL
FBBBBBFRLR
BFFBBFBLLL
FBBFBFBLRR
BBFFFBFRRL
BFFFBBBRLL
BFBBFFFRRR
FBFBFBBRLR
FBBFFBBRRL
FFBBFFBLRR
FBBBBBFRRL
FBBBBBFRRR
FBFFBFBRRR
BFBBBBBRLR
BFBFBBBRRR
BBFFBBBRRL
FBBFFBBLRR
BFBBFBFLRL
BFFFFFFRLL
FBFBFFFLLL
FFBBFBBRRL
BFFFBFFRLL
FFBBBFBLRL
FFBFBFFLLL
BBFFFBBLLR
BFBBBBBRRL
FBBFBBBLLL
BFFBBFBRRL
FFBBFBBLRL
BFBBBBFLRL
BFFBFBBLLL
FFFBFBBLRL
FFBBFBBRRR
FBBFFFFRRR
FBFFFFFLRR
BBFFBFBRLL
BFBFFFFLLL
FFBFBFFRLR
FFBFFFBLLL
BBFFFFFRRR
BFBFBFFRRL
FBBFFBFLLL
BFFFBFFRLR
BFBBBFFRLR
FFFBBFFRLR
FBBBBFBRLL
FBBBFFBRLL
FBFBFFBRRL
BFFBFFFRRL
BFFBBBFLRL
BFBBBBBLLL
BFBFFFFRLR
FFBFBBBLRL
FFBFBBBLLR
FFBBFBFLRL
BBBFFFFLLR
FBBFBFBRLL
BFFFFBBLLL
BFBFBBBLLR
FBFFBFFLRL
BBFFBBFRRL
FBBFBBFLLR
FFFBBFBLLR
FFBBBBBLLL
FFBFBFFLRL
BFFFFBFLLR
BFBFBBFLRL
BFFFBFBLLR
BBFFBFBRLR
FBBBFFBLRL
FBFFBBBRLL
FBBFFBFRRL
FFFBBFBLRR
BBFFBBFRRR
BFBFFFBRRL
FBBBBFFRRL
BFFFBBFLLL
FFBBBFFLRL
FBFBBBFRLL
FBBBFBBRLL
BBFFBFFLRL
FFBFBFBLRR
FFFBBBFRRR
BFFBFBBLLR
FBBFBBBRLR
BFFFBBBRRR
FFFBFBFRRR
FBFFBFFRRR
FFFBBBBLRR
BFFFBBFLLR
BFFFBFBLRL
FBBFFBBRLL
BBFFBBFRLR
BFFFBBFRLR
BFFBBBBLLL
FFBBFFBRLR
FFBFBFFRRL
BFBBBFFLLL
BFBFBBFRRR
FBFBFBFRLL
BFBBFBFRRR
BBFBFBBRRR
BFBBBBBLLR
FFBFFFBRLL
FFBFFBFLLR
BBFBFBBLRL
BBFFBBFLRL
BFBFBBBLRR
FFBFBBBRLL
BBFBBFFLLL
FBFFBBBLRL
FFBBBFFLLL
FBBFBBBRRL
BBFFFBBLLL
FBBBFFBRRL
FFBBBBBRRL
BFBBFBBLLL
FFBFFBBRRR
BFBBFFBLLR
BFFFFFFLLL
BFFFFBBLRR
BFBFFBFLRR
FBBBBBFLRR
BBFBFBFLRL
FBBFFBFLRL
BFFFFBFRLL
BFFFBBBRRL
FFBFBFBRLR
FFBBFBBLRR
FBBFBBBLLR
FBBFFFBRRL
BFFFBFBRLL
BFFBBBBRLL
FFBBFFFLRR
BBFBBFFRRR
FBFBFBBLLR
FFBBBBBLRR
FFBBBFBLRR
BBFBBBFRLL
BFBBFFBRLR
FBFFBFFRLL
FBBBFFFLLL
BFBBFBFLRR
FBFFFFFLLR
FBBBFBFRRR
FFBBBFFLLR
FBBBFFBLLR
FBFFFBFLRR
FBFFBFBLRL
BFFBBFFRLR
FBFBBFFRLR
FBBBFFFRRL
FFBFFFFRRR
FFFBFBFRRL
FFFBBBBRRL
FBFFBFFLLL
FFFBBFFRRR
BFFBFFFLLR
BFFBBBFRRL
BBFFFBFLLR
BBFBFFFLLR
FFFBBFBRLL
FBFBBFFRRR
BBFFBFFRLR
FBFFBFBLLR
BFBFBFFLRR
FBBBBBBLRR
BFBBBFBRRR
FFFBBFFLLR
BFFFFBFLRR
FFBFFBFRRL
BBFFBFFLRR
BFBFFBFRRR
BBFBBBFLLR
FFBBFFFLLR
FBBFFFBLRR
FFFBFBBRRL
FBFBFBBRRR
BBFBFBBRLL
FBFBFBFRLR
FFBBBBBLRL
BFBBFBBRRL
FBFBFFFLLR
BFBFBFBLRL
BFBBBFFLLR
BBFFFFBLLR
BFBFBBBLRL
BBFFFFBRLR
BBFBBFBLRL
BFBFBFFLLL
FFBFBFBLLR
FBBBFBBRLR
FBFBBBFLRL
FBBFBBBRLL
BFFFFBFRRL
BFBFBBFRLR
FFBFFFBRRL
BFFBFFBRRR
BBFBBFFRRL
FBBBBFBRRR
FFBFFBBRRL
BFBFFBBLLL
BFBFFFBLLL
FFFBBBBLLR
FBFBFFFLRL
FFBBBFBLLL
BFFBFFBLLR
FBBBFBFRLL
FFBBFFBLRL
BFBFFFBLLR
FBFFFFBRRL
BFFBFFBRRL
BBFFFBBLRR
FBFFFBBRLR
BFFFFFBLRR
BBFBFFBRLR
FFBBBFFRRR
FBBFFFFLRR
FBBBFBFLLL
BBFBBFBRLL
FFBFFBBLRR
BBFBBBBRLR
FBBBBBFLRL
BBFFBFBLRL
BFBFBFFRLL
BBFBFBFLLL
FBFFBBBRRR
BBFFBFFRRR
FFBBBFFRRL
FBFBFBBRRL
BFFBBBBRRR
BBBFFFFRLR
BBFFFBBRLL
FBFBBFBLLR
BBFBFFFRRL
BBFFBBBLLL
BBFBFBFRRR
FBFFFBBLLR
BBFFBFBLLR
BBFBBFFLRR
BBFFFBBRRR
BFBBBFFRRR
BFBFBBBRLL
FBBBFFFLRR
FBFFFFFLLL
FBFBFFBRLR
FBFFBFBLRR
FBFBFFFRRL
FBBBBBBRRL
BFFFFBBRLR
FBFFFFBLLL
BFFBBBBRRL
BFBBBBBRLL
BFBBFFBLLL
BFFBFBFLLL
FFFBFBBRLR
FFBFBBFRRL
FFBFBFBRLL
BBFBFFBLRL
BFFBBFBRLR
BFFFFBBRRR
FFBBFBFLLR
BFBFBFBRRL
BFFFFFFRRL
BFFBFBFRLR
FBBFBFFRRL
FBFBBBBLLR
BFFFBBBLLL
BBFBFFFLRL
BBFBFBFRLL
FFBFBFFLLR
BBFFBFBRRL
BFFBBFFRRR
FBFFBBFRLR
FBFBFFBLRR
BFFBFBFLRR
BFFFFFBRLR
FBFFFFBRRR
FBFFBFFRRL
FFBFBBFRLR
FFBBBBFRRR
FFBBBFFRLL
FBBBBBBLLL
FBBBFBBLRR
FBFBBFBLLL
BFBFFFBRRR
FBFBBBBRLR
FFBFBBFRRR
FBFBBFFRRL
BFFBBBBLRR
BBFFBBBLRL
BBFFBBBLLR
FFBFBFBLRL
BFBBFBBLRL
FFBFBBBRRR
BBBFFFFLRL
FFFBBFFLRR
BFBBBBFLRR
BFFFBFBRRL
FBFFFBFRLL
BBFFFBFRRR
BFFBBBBRLR
FFBFFFBRLR
FFFBFBBLRR
BFBFFBFLRL
BFBBFBBRLR
BFFBFFFRLL
FFBFBFFRRR
BFFBBFBRLL
FBFBBFBRLL
FBBFFBBLLR
BFBFFFFLRR
BFFFFBBLRL
FBFBBFBRLR
FFBBFFFRRL
FFBBFFBLLL
BFBFBBBLLL
FFFBBBBRLL
FFFBFBBRLL
BFFBFBFRRR
FFBBFBFLLL
BBFBBFFRLR
BFBBBBFRLL
BBFFFFFLLR
FFBBFFBLLR
FBFFBFBRLR
FBBFBBBRRR
BFFBBBFLLL
BFBFFBBRRR
BFBFFFFLLR
FFFBBBBRRR
FBBFBFBLRL
BFFFFBBRLL
FBFFBBFRLL
FFBBBFFRLR
BFFFBFBRLR
FBBFBBFRRL
FBBFBBFRRR
BFBFFFBLRR
BFFFFBFLRL
BFBFFBBRRL
BFBFBBFLLR
FBBBFBBRRR
FFBFBBBRLR
BFBBBFBRLL
BFFBFFBLRR
BFFFFFFLRR
FBFFFFBLLR
BBFBFFFRLL
FBFFFBBLRR
FBBBFFFRLL
BBFFFFFRLR
BFBFFBFRLL
FBBFFFBLRL
FFBFFBFRLR
FBBFFFBLLR
BFBFBFBLLL
BFFBFFFRLR
BFFFBFFRRL
BFFFBBFRLL
BFFBBFFRRL
BBFFBBBLRR
BBFBBBBRRR
FBBBFFBRLR
FBBBBFBRLR
BFBBBFFRLL
BBFBFFBLLL
BFBBBFBLLL
FFBFFFFRLL
BBBFFFFRLL
BBFBFBBRLR
BBFBFBFRLR
FBFBBFFLLR
FFBFBBFLLL
FFFBBFBRLR
BBFBBBFLRL
BFBBFFBLRR
BBFFFBFLRL
BFFBBFBRRR
BFFBFBBLRL
BFFBBBFRLR
BFBBFBFLLL
FBBBFFFLRL
FBFBFFBLLR
FFFBBBFRLR
FFBFFBBLRL
FBBBFFFLLR
FBBBFFBLLL
BFBFFBBLRR
FFBFFFFLLR
FBFBBBFLRR
BBFBFBBLLL
FBFBBBBRLL
FBBBFFBRRR
FBBFBBFLRL
FBFBFBFLRR
FBBBFBFLRR
BFFFBFFLLL
BFBBBFBRRL
BFBFBFBRLR
FBFFFFFRLL
BBFBFFFLLL
FBFBBBBLRL
BBFBFBFLRR
FBFBFBBLLL
BBFFBBFLLL
BBFBBBBLLR
BBFBBFBRLR
BFFBFBBRLL
FBBBFFBLRR
FFBFFFFLLL
FBFFBBFLLL
FFBBFBFLRR
FBBBBBFLLL
FBFBFFFRRR
BFBFBFFRLR
FFBBFBFRRR
FBFBBBBRRL
BFBFBFFLLR
FBFBFBBLRR
FBBBBFBLRR
BFFFBFFRRR
BBFBBBBRRL
BBFBBBFRLR
BFBBBBBRRR
BBFFFFBLRL
BBFFFFBLRR
FBFBBFBLRR
FBBBFBBLLL
FBBBFFFRLR
FBBBFBBRRL
BBFFFFFLRL
FBFFFFBLRR
FFFBFBBLLL
BFBBFFFRRL
FFBFBBFRLL
FFBFBFBLLL
BFFBFBBRRL
BFFBBBFLLR
FBBBBFFRRR
FBFBFBBRLL
FFBBFFFRLR
FFBBFFBRRR
BBFFFBFLRR
FBFBBBBLLL
BFFBBBFRLL
BBFFBBBRRR
FFFBBBFRLL
BFFBBFBLRR
FBFFFBFRRR
FFBBBBFRLL
FBFFFBBRLL
FBBBBBBRRR
BFBFFFFRRR
FFBBBFBRLL
FBBFBFFLRL
FBBFFBBRLR
BBFBBFBRRR
BBFBFFFRLR
FFFBFBBRRR
FFFBBBFLLR
BBFBBBFRRR
BFFBBBBLRL
FFBFFFFLRR
BFFBBFFLLL
BBFFBFFLLR
BFBFFBFRRL
FBFFFBFLLL
FFBFBFBRRR
FFBBFFBRLL
BFBBFBFRLL
FBFBBBFLLR
FFBFBBBLLL
FFBBBFBLLR
FBFFFFBRLR
FFBFBBBLRR
FFFBBBBRLR
FFBBBFFLRR
FBFFBBFRRL
BBFBFFBRLL
BFFFBBFLRR
FBFBFFFLRR
FBBBBFFLRR
BFFFBBBLRL
BBFFFBFLLL
FBFFFFFRRL
FFBBBBBRLR
BFBFFFBRLL
FBFBFBBLRL
FBBFFBBLRL
FBBFFFFRRL
BBFBBFFRLL
FBBFFFFLLL
FFBBFBBRLR
BFBFBBBRRL
FFBBBBBLLR
FBBFFBFRLL
FFBFFBFLRL
FBBBBFBRRL
FFFBBBBLRL
BFFBFBFRLL
FBFBFFBLRL
FBFFFBBRRL
BFFBFFBLLL
BFBBBBFLLL
FBFBBBBRRR
FBBBFBFRLR
BFBBFBFRLR
BFFBFFFRRR
BFBBBFBRLR
BFFBFBBLRR
BBFFFBFRLR
BFFFFFFLRL
BBFFFBBLRL
BFFFFFFRRR
FFBFFFFRRL
FBBFBBFRLL
BBFBFFBLLR
BFFFFFBLLL
BFBBBBBLRL
FBBBBBFLLR
BBFFFFFLRR
BFBBBBBLRR
FBBFBFFRLL
FFFBBBFLLL
BBFFFFBRLL
BFFFBBFRRL
FBFFBBBRRL
FBBBBBBRLL
FFFBBFFLLL
FFBFFBFLLL
BFBBFFBLRL
FBFFFFFRRR
BBFFFFFRRL
FBFFBBBLLR
BFBFBBFLRR
FBFFBFBLLL
FBFBBFFRLL
BBFBBFBLRR
BBFFFFBRRR
FBBBFBFRRL
FFBBFBBRLL
BFFBFFFLRR
FBBBBFFRLR
BBFFFFFLLL
FBBFBFBRRR
BFBBBFFLRL
FFBFFBFLRR
BFBFBFBLLR
BFFFBBBRLR
FBFBFFFRLL
BFFFFFFLLR
FFBBFFFLLL
FFBBFFFRLL
BBFFBFFRRL
BFBBFFFLRR
FBFFFBBRRR
BBFFBFFLLL
BFBBFFFLRL
BFBFFFBLRL
FBFFFBFRRL
BBFFBBBRLR
FBFFBBFRRR
BBFFBBBRLL
FBBFBFFLLR
FBBFFBFRRR
BBFBBFFLRL
FFBFFFBLLR
FBFFFBFRLR
FBFFBBBLLL
FBBBBFBLLR
BFBBFBBRRR
BFBBBBFRRR
FBFFBBBRLR
BFBFFBBRLR
FFBBBBFLRL
BBFFFFBRRL
BFFFBBBLRR
BBFBBBBLRR
FBBFBFFRRR
FBFFBFFLRR
BFFBFBFRRL
FFBFFBFRLL
BBFBFFBLRR
FFFBFBBLLR
BFBFFBFLLR
BFFFFFFRLR
BBFBBFBLLL
BBFFBFBRRR
BFBFBBFLLL
FBFFBFFLLR
FFBBBBFRRL
FFFBFBFRLR
BBFBFBFLLR
FBBFFFFRLR
FFBFFBFRRR
FFBFFFBRRR
FFFBBFFRLL
BFFBBFFLRL
BBFBBBBLLL
BFBBBBFLLR
BFBBFFFLLR
FFBBBFBRLR
FBBBFBBLLR
"""
